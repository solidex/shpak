# ПРОГРАММА И МЕТОДИКА ИСПЫТАНИЙ АПК
## Автоматизированная Политика Контроля

---

## 1. ОБЩИЕ ПОЛОЖЕНИЯ

### 1.1 Назначение документа
Настоящий документ определяет программу и методику проведения испытаний системы АПК (Автоматизированная Политика Контроля), включая внешние и внутренние тесты компонентов системы.

### 1.2 Цель испытаний
- Проверка функциональности всех компонентов системы АПК
- Валидация интеграции между сервисами
- Проверка отказоустойчивости системы
- Оценка производительности и надежности

### 1.3 Область применения
Документ применяется для проведения приемочных испытаний системы АПК в составе:
- FortiGate Firewall
- Kubernetes кластер
- RADIUS сервер
- Система мониторинга Zabbix
- LDAP каталог
- Система отчетности Superset

---

## 2. ВНЕШНИЕ ТЕСТЫ

### 2.1 Состояние конфигурации FortiGate

#### 2.1.1 Проверка синхронизации системных часов по протоколу NTP

**Цель:** Убедиться в корректной синхронизации времени на устройствах FortiGate

**Процедура:**
1. Подключиться к консоли FortiGate
2. Выполнить команду: `execute ntp status`
3. Проверить статус синхронизации
4. Выполнить команду: `execute ntp list`
5. Проверить доступность NTP серверов

**Критерии успеха:**
- Статус синхронизации: "Synchronized"
- Время отклонения от NTP сервера: не более ±1 секунды
- Все настроенные NTP серверы доступны

**Ожидаемый результат:** FortiGate синхронизирован с NTP серверами

#### 2.1.2 Проверка функционирования службы обновления баз данных

**Цель:** Проверить актуальность и работоспособность антивирусных и IPS баз

**Процедура:**
1. Выполнить команду: `execute update-now`
2. Проверить статус обновления: `execute update status`
3. Проверить версии баз данных: `execute update list`
4. Проверить расписание автообновления: `config system autoupdate`

**Критерии успеха:**
- Базы данных обновлены не позднее 24 часов назад
- Статус последнего обновления: "Success"
- Автообновление включено и настроено

**Ожидаемый результат:** Базы данных актуальны и обновляются автоматически

#### 2.1.3 Проверка состояния FGCP кластера

**Цель:** Проверить работоспособность кластера FortiGate

**Процедура:**
1. Выполнить команду: `execute ha status`
2. Проверить роли устройств (Primary/Secondary)
3. Проверить состояние синхронизации: `execute ha sync-status`
4. Проверить интерфейсы HA: `config system ha`

**Критерии успеха:**
- Статус кластера: "Cluster"
- Синхронизация конфигурации: "In Sync"
- Все HA интерфейсы в состоянии "Up"

**Ожидаемый результат:** Кластер FortiGate функционирует корректно

#### 2.1.4 Проверка принятия сообщений Accounting-Start/Stop от RADIUS

**Цель:** Проверить обработку RADIUS сообщений учета

**Процедура:**
1. Настроить тестового пользователя в RADIUS
2. Выполнить аутентификацию пользователя
3. Проверить логи FortiGate: `execute log filter category 0`
4. Найти записи Accounting-Start/Stop
5. Проверить корректность обработки сообщений

**Критерии успеха:**
- Сообщения Accounting-Start/Stop принимаются
- Пользовательские сессии корректно отслеживаются
- Логи содержат записи о RADIUS событиях

**Ожидаемый результат:** FortiGate корректно обрабатывает RADIUS сообщения

#### 2.1.5 Проверка отправки данных в Zabbix

**Цель:** Проверить мониторинг системных параметров

**Процедура:**
1. Проверить настройки SNMP: `config system snmp`
2. Проверить отправку данных в Zabbix
3. Проверить метрики:
   - Температура
   - Загрузка CPU
   - Загрузка RAM
   - Активные сессии
   - HTTP соединения
   - Ошибки на портах
   - Загрузка интерфейсов
   - Дисковое пространство

**Критерии успеха:**
- SNMP агент настроен и активен
- Все метрики передаются в Zabbix
- Данные обновляются с интервалом не более 5 минут

**Ожидаемый результат:** Мониторинг FortiGate функционирует корректно

#### 2.1.6 Проверка отправки системных событий

**Цель:** Проверить отправку SNMP trap сообщений

**Процедура:**
1. Проверить настройки SNMP trap: `config system snmp trap`
2. Сгенерировать тестовое событие
3. Проверить доставку trap в систему сбора
4. Проверить корректность формата сообщений

**Критерии успеха:**
- SNMP trap настроены корректно
- События доставляются в систему сбора
- Формат сообщений соответствует стандарту

**Ожидаемый результат:** Системные события передаются корректно

#### 2.1.7 Проверка аутентификации администраторов по TACACS+

**Цель:** Проверить интеграцию с TACACS+ и FortiManager

**Процедура:**
1. Настроить TACACS+ сервер
2. Выполнить аутентификацию администратора
3. Проверить авторизацию через FortiManager
4. Проверить логи аутентификации

**Критерии успеха:**
- Аутентификация через TACACS+ работает
- Авторизация через FortiManager функционирует
- Логи содержат записи об аутентификации

**Ожидаемый результат:** Аутентификация и авторизация работают корректно

### 2.2 Функционирование фильтрации трафика FortiGate

#### 2.2.1 Проверка групповых политик для различных типов подключений

**Цель:** Проверить применение групповых политик для PPPoE, Ethernet, Wi-Fi

**Процедура:**
1. Настроить тестовые групповые политики
2. Создать тестовых пользователей с разными типами подключения
3. Проверить применение политик для каждого типа
4. Проверить логи фильтрации

**Критерии успеха:**
- Групповые политики применяются для всех типов подключений
- Фильтрация работает согласно настройкам
- Логи содержат записи о применении политик

**Ожидаемый результат:** Групповые политики работают для всех типов подключений

#### 2.2.2 Проверка индивидуальных политик для PPPoE

**Цель:** Проверить применение индивидуальных политик для PPPoE пользователей

**Процедура:**
1. Настроить индивидуальные политики для тестовых пользователей
2. Выполнить аутентификацию PPPoE пользователей
3. Проверить применение индивидуальных политик
4. Проверить логи применения политик

**Критерии успеха:**
- Индивидуальные политики применяются корректно
- Пользователи получают доступ согласно политикам
- Логи содержат записи о применении индивидуальных политик

**Ожидаемый результат:** Индивидуальные политики работают для PPPoE

#### 2.2.3 Проверка сервисов безопасности

**Цель:** Проверить работу AV, IPS, DNS, SSL-Inspection

**Процедура:**
1. **Антивирус (AV):**
   - Отправить тестовый вирус
   - Проверить блокировку
   - Проверить логи AV

2. **IPS:**
   - Отправить тестовую атаку
   - Проверить блокировку
   - Проверить логи IPS

3. **DNS фильтрация:**
   - Обратиться к заблокированному сайту
   - Проверить перенаправление на специальный ресурс
   - Проверить логи DNS

4. **SSL-Inspection:**
   - Проверить сертификаты
   - Проверить расшифровку трафика
   - Проверить логи SSL

**Критерии успеха:**
- AV блокирует вирусы
- IPS блокирует атаки
- DNS перенаправляет на специальный ресурс
- SSL-Inspection работает корректно

**Ожидаемый результат:** Все сервисы безопасности функционируют

### 2.3 Отказоустойчивость

#### 2.3.1 Проверка отказоустойчивости FortiGate

**Цель:** Проверить работу системы при выходе из строя активного FW

**Процедура:**
1. Определить активное устройство в кластере
2. Отключить активное устройство
3. Проверить переключение на резервное
4. Проверить восстановление сервисов
5. Включить устройство обратно
6. Проверить восстановление кластера

**Критерии успеха:**
- Переключение происходит автоматически
- Время переключения не более 30 секунд
- Сервисы восстанавливаются автоматически
- Кластер восстанавливается после включения устройства

**Ожидаемый результат:** Система отказоустойчива

#### 2.3.2 Проверка отказоустойчивости коммутатора

**Цель:** Проверить работу при выходе из строя коммутатора

**Процедура:**
1. Определить коммутатор, подключенный к FW
2. Отключить коммутатор
3. Проверить переключение на резервный
4. Проверить восстановление соединений
5. Включить коммутатор обратно
6. Проверить восстановление

**Критерии успеха:**
- Переключение происходит автоматически
- Время переключения не более 60 секунд
- Соединения восстанавливаются
- Система возвращается в нормальное состояние

**Ожидаемый результат:** Система устойчива к отказу коммутатора

#### 2.3.3 Проверка отказоустойчивости узла K8s

**Цель:** Проверить работу при выходе из строя узла кластера

**Процедура:**
1. Определить узел кластера K8s
2. Отключить узел
3. Проверить переключение подов на другие узлы
4. Проверить восстановление сервисов
5. Включить узел обратно
6. Проверить восстановление кластера

**Критерии успеха:**
- Поды переключаются на другие узлы
- Время переключения не более 5 минут
- Сервисы восстанавливаются
- Кластер возвращается в нормальное состояние

**Ожидаемый результат:** Кластер K8s отказоустойчив

---

## 3. ВНУТРЕННИЕ ТЕСТЫ

### 3.1 Состояние кластера K8s

#### 3.1.1 Проверка связности узлов K8s

**Цель:** Проверить состояние кластера Kubernetes

**Процедура:**
1. Выполнить команду: `kubectl get nodes`
2. Проверить статус узлов: `kubectl describe nodes`
3. Проверить связность: `kubectl get pods --all-namespaces`
4. Проверить состояние кластера: `kubectl cluster-info`

**Критерии успеха:**
- Все узлы в состоянии "Ready"
- Нет узлов в состоянии "NotReady"
- Кластер функционирует корректно

**Ожидаемый результат:** Кластер K8s функционирует

#### 3.1.2 Проверка статуса Cilium, BGP, Egress Gateway

**Цель:** Проверить состояние сетевых компонентов

**Процедура:**
1. Проверить статус Cilium: `kubectl get pods -n kube-system | grep cilium`
2. Проверить BGP связность: `cilium status`
3. Проверить Egress Gateway: `kubectl get pods -n kube-system | grep egress`
4. Проверить сетевые политики: `kubectl get networkpolicies`

**Критерии успеха:**
- Cilium поды в состоянии "Running"
- BGP связность установлена
- Egress Gateway функционирует
- Сетевые политики применены

**Ожидаемый результат:** Сетевые компоненты работают

#### 3.1.3 Проверка статуса сервисов и подов

**Цель:** Проверить состояние всех сервисов АПК

**Процедура:**
1. Проверить статус подов: `kubectl get pods --all-namespaces`
2. Проверить статус сервисов: `kubectl get services --all-namespaces`
3. Проверить логи подов: `kubectl logs <pod-name> -n <namespace>`
4. Проверить ресурсы: `kubectl top pods --all-namespaces`

**Критерии успеха:**
- Все поды в состоянии "Running"
- Сервисы доступны
- Нет критических ошибок в логах
- Ресурсы используются в пределах нормы

**Ожидаемый результат:** Все сервисы функционируют

### 3.2 Функционирование сервисов K8s

#### 3.2.1 MHE RADIUS, MHE App

**Цель:** Проверить работу RADIUS и приложения

**Процедура:**
1. **Индивидуальные политики (группа №2):**
   - Создать тестового пользователя с групповой политикой №2
   - Выполнить аутентификацию
   - Проверить формирование индивидуального списка портов
   - Проверить применение политики

2. **Групповые политики (группы №1-9):**
   - Создать тестовых пользователей с групповыми политиками №1-9
   - Выполнить аутентификацию
   - Проверить применение групповых политик
   - Проверить фильтрацию трафика

**Критерии успеха:**
- Индивидуальные списки портов формируются корректно
- Групповые политики применяются согласно настройкам
- Фильтрация работает для всех групп
- Логи содержат записи о применении политик

**Ожидаемый результат:** RADIUS и приложение работают корректно

#### 3.2.2 MHE Log

**Цель:** Проверить сбор сообщений о событиях безопасности

**Процедура:**
1. Сгенерировать тестовые события безопасности
2. Проверить сбор логов: `kubectl logs <mhe-log-pod> -n <namespace>`
3. Проверить отправку в систему сбора
4. Проверить формат сообщений
5. Проверить обработку различных типов событий

**Критерии успеха:**
- События безопасности собираются
- Логи отправляются в систему сбора
- Формат сообщений соответствует стандарту
- Все типы событий обрабатываются

**Ожидаемый результат:** Система логирования функционирует

#### 3.2.3 MHE Restore

**Цель:** Проверить восстановление политик FortiGate

**Процедура:**
1. Создать тестовые политики в FortiGate
2. Отключить FortiGate
3. Проверить работу MHE Restore
4. Включить FortiGate
5. Проверить восстановление политик
6. Сравнить политики до и после восстановления

**Критерии успеха:**
- MHE Restore функционирует при отказе FortiGate
- Политики восстанавливаются корректно
- Время восстановления в пределах нормы
- Политики соответствуют сохраненным

**Ожидаемый результат:** Восстановление политик работает

#### 3.2.4 MHE LDAP

**Цель:** Проверить получение данных из LDAP каталога

**Процедура:**
1. Настроить подключение к LDAP
2. Проверить аутентификацию: `kubectl logs <mhe-ldap-pod> -n <namespace>`
3. Проверить получение данных пользователей
4. Проверить синхронизацию данных
5. Проверить обработку изменений в LDAP

**Критерии успеха:**
- Подключение к LDAP установлено
- Данные пользователей получаются корректно
- Синхронизация работает
- Изменения в LDAP обрабатываются

**Ожидаемый результат:** Интеграция с LDAP функционирует

#### 3.2.5 MHE E-Mail

**Цель:** Проверить отправку уведомлений пользователям

**Процедура:**
1. Настроить SMTP сервер
2. Создать тестовые события безопасности
3. Проверить отправку уведомлений
4. Проверить получение уведомлений
5. Проверить ссылки на данные о событиях
6. Проверить доступ к данным о событиях

**Критерии успеха:**
- Уведомления отправляются пользователям
- Ссылки на данные о событиях работают
- Пользователи получают доступ к данным
- Формат уведомлений соответствует требованиям

**Ожидаемый результат:** Система уведомлений функционирует

#### 3.2.6 StarRocks

**Цель:** Проверить удаление записей по истечении времени

**Процедура:**
1. Создать тестовые записи о событиях безопасности
2. Проверить их наличие в базе данных
3. Дождаться истечения заданного интервала времени
4. Проверить автоматическое удаление записей
5. Проверить настройки политики удаления

**Критерии успеха:**
- Записи создаются в базе данных
- Автоматическое удаление работает
- Время удаления соответствует настройкам
- Политика удаления настроена корректно

**Ожидаемый результат:** Автоматическое удаление записей работает

#### 3.2.7 Superset

**Цель:** Проверить формирование отчетов о событиях безопасности

**Процедура:**
1. Подключиться к Superset
2. Создать тестовые отчеты по атрибутам:
   - Абонент
   - Тип события
   - Период
3. Проверить корректность данных в отчетах
4. Проверить фильтрацию по атрибутам
5. Проверить экспорт отчетов

**Критерии успеха:**
- Отчеты формируются корректно
- Фильтрация по атрибутам работает
- Данные в отчетах соответствуют реальным
- Экспорт отчетов функционирует

**Ожидаемый результат:** Система отчетности функционирует

---

## 4. МЕТОДИКА ПРОВЕДЕНИЯ ИСПЫТАНИЙ

### 4.1 Подготовка к испытаниям

#### 4.1.1 Требования к тестовой среде
- Все компоненты системы должны быть развернуты
- Тестовая среда должна быть изолирована от производственной
- Необходимо наличие тестовых данных и пользователей
- Должны быть настроены системы мониторинга

#### 4.1.2 Требования к персоналу
- Инженер по тестированию
- Администратор системы
- Специалист по безопасности
- Представитель заказчика

#### 4.1.3 Необходимое оборудование
- Рабочие станции для тестирования
- Сетевое оборудование
- Измерительные приборы
- Документация по системе

### 4.2 Порядок проведения испытаний

#### 4.2.1 Этап 1: Подготовка
1. Проверка готовности тестовой среды
2. Настройка инструментов тестирования
3. Подготовка тестовых данных
4. Проверка доступности всех компонентов

#### 4.2.2 Этап 2: Внешние тесты
1. Тестирование FortiGate
2. Тестирование фильтрации трафика
3. Тестирование отказоустойчивости
4. Документирование результатов

#### 4.2.3 Этап 3: Внутренние тесты
1. Тестирование кластера K8s
2. Тестирование сервисов
3. Тестирование интеграций
4. Документирование результатов

#### 4.2.4 Этап 4: Анализ результатов
1. Обработка результатов тестирования
2. Выявление проблем и их анализ
3. Подготовка отчета
4. Рекомендации по устранению проблем

### 4.3 Критерии оценки результатов

#### 4.3.1 Успешное прохождение теста
- Все проверки выполнены успешно
- Критерии успеха соблюдены
- Документация заполнена
- Результаты зафиксированы

#### 4.3.2 Неуспешное прохождение теста
- Обнаружены критические ошибки
- Критерии успеха не соблюдены
- Требуется доработка системы
- Необходимо повторное тестирование

### 4.4 Документирование результатов

#### 4.4.1 Протокол испытаний
- Дата и время проведения
- Состав комиссии
- Результаты каждого теста
- Выявленные проблемы
- Рекомендации

#### 4.4.2 Отчет о результатах
- Общая оценка системы
- Анализ выявленных проблем
- Рекомендации по устранению
- Заключение о готовности системы

---

## 5. ЗАКЛЮЧЕНИЕ

Настоящая программа и методика испытаний обеспечивает комплексную проверку системы АПК на соответствие техническим требованиям и функциональным характеристикам. Соблюдение данной методики гарантирует качественное проведение испытаний и получение достоверных результатов о состоянии системы.

---

**Документ подготовлен:** [Дата]  
**Версия:** 1.0  
**Статус:** Утвержден