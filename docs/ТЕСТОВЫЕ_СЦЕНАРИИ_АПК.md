# ТЕСТОВЫЕ СЦЕНАРИИ ДЛЯ ИСПЫТАНИЙ АПК

## 1. СЦЕНАРИИ ВНЕШНИХ ТЕСТОВ

### 1.1 Сценарий: Проверка синхронизации NTP

**ID:** EXT-NTP-001  
**Приоритет:** Высокий  
**Время выполнения:** 5 минут  

**Предусловия:**
- FortiGate подключен к сети
- NTP серверы настроены и доступны

**Шаги выполнения:**
1. Подключиться к консоли FortiGate
2. Выполнить `execute ntp status`
3. Зафиксировать статус синхронизации
4. Выполнить `execute ntp list`
5. Проверить доступность NTP серверов
6. Выполнить `execute ntp query <server>`
7. Зафиксировать время отклонения

**Ожидаемый результат:**
- Статус: "Synchronized"
- Отклонение: ±1 секунда
- Все серверы доступны

**Критерии успеха:**
- ✅ Синхронизация активна
- ✅ Время корректно
- ✅ Серверы доступны

---

### 1.2 Сценарий: Проверка обновления баз данных

**ID:** EXT-UPDATE-001  
**Приоритет:** Высокий  
**Время выполнения:** 10 минут  

**Предусловия:**
- FortiGate подключен к интернету
- Служба обновления настроена

**Шаги выполнения:**
1. Выполнить `execute update status`
2. Проверить статус последнего обновления
3. Выполнить `execute update list`
4. Проверить версии баз данных
5. Выполнить `execute update-now`
6. Дождаться завершения обновления
7. Проверить новые версии баз

**Ожидаемый результат:**
- Обновление завершено успешно
- Базы данных актуальны
- Автообновление включено

**Критерии успеха:**
- ✅ Обновление успешно
- ✅ Базы актуальны
- ✅ Автообновление работает

---

### 1.3 Сценарий: Проверка FGCP кластера

**ID:** EXT-FGCP-001  
**Приоритет:** Критический  
**Время выполнения:** 15 минут  

**Предусловия:**
- Кластер FortiGate настроен
- Оба устройства подключены

**Шаги выполнения:**
1. Выполнить `execute ha status`
2. Определить Primary/Secondary устройства
3. Выполнить `execute ha sync-status`
4. Проверить синхронизацию конфигурации
5. Выполнить `config system ha`
6. Проверить настройки HA
7. Проверить интерфейсы HA

**Ожидаемый результат:**
- Кластер функционирует
- Синхронизация активна
- HA интерфейсы работают

**Критерии успеха:**
- ✅ Кластер активен
- ✅ Синхронизация работает
- ✅ HA настроено корректно

---

### 1.4 Сценарий: Проверка RADIUS Accounting

**ID:** EXT-RADIUS-001  
**Приоритет:** Высокий  
**Время выполнения:** 20 минут  

**Предусловия:**
- RADIUS сервер настроен
- Тестовые пользователи созданы

**Шаги выполнения:**
1. Настроить тестового пользователя
2. Выполнить аутентификацию
3. Проверить логи FortiGate
4. Найти записи Accounting-Start
5. Завершить сессию пользователя
6. Проверить записи Accounting-Stop
7. Проверить корректность данных

**Ожидаемый результат:**
- Сообщения принимаются
- Сессии отслеживаются
- Логи корректны

**Критерии успеха:**
- ✅ Accounting-Start получен
- ✅ Accounting-Stop получен
- ✅ Данные корректны

---

### 1.5 Сценарий: Проверка мониторинга Zabbix

**ID:** EXT-ZABBIX-001  
**Приоритет:** Средний  
**Время выполнения:** 30 минут  

**Предусловия:**
- Zabbix сервер настроен
- SNMP агент активен

**Шаги выполнения:**
1. Проверить настройки SNMP
2. Проверить подключение к Zabbix
3. Проверить метрики температуры
4. Проверить метрики CPU
5. Проверить метрики RAM
6. Проверить активные сессии
7. Проверить HTTP соединения
8. Проверить ошибки портов
9. Проверить загрузку интерфейсов
10. Проверить дисковое пространство

**Ожидаемый результат:**
- Все метрики передаются
- Данные актуальны
- Мониторинг работает

**Критерии успеха:**
- ✅ SNMP настроен
- ✅ Метрики передаются
- ✅ Данные актуальны

---

## 2. СЦЕНАРИИ ВНУТРЕННИХ ТЕСТОВ

### 2.1 Сценарий: Проверка кластера K8s

**ID:** INT-K8S-001  
**Приоритет:** Критический  
**Время выполнения:** 20 минут  

**Предусловия:**
- Кластер K8s развернут
- kubectl настроен

**Шаги выполнения:**
1. Выполнить `kubectl get nodes`
2. Проверить статус узлов
3. Выполнить `kubectl describe nodes`
4. Проверить ресурсы узлов
5. Выполнить `kubectl get pods --all-namespaces`
6. Проверить статус подов
7. Выполнить `kubectl cluster-info`
8. Проверить состояние кластера

**Ожидаемый результат:**
- Все узлы Ready
- Поды работают
- Кластер функционирует

**Критерии успеха:**
- ✅ Узлы готовы
- ✅ Поды работают
- ✅ Кластер стабилен

---

### 2.2 Сценарий: Проверка Cilium и BGP

**ID:** INT-CILIUM-001  
**Приоритет:** Высокий  
**Время выполнения:** 15 минут  

**Предусловия:**
- Cilium установлен
- BGP настроен

**Шаги выполнения:**
1. Выполнить `kubectl get pods -n kube-system | grep cilium`
2. Проверить статус подов Cilium
3. Выполнить `cilium status`
4. Проверить состояние Cilium
5. Проверить BGP связность
6. Выполнить `kubectl get networkpolicies`
7. Проверить сетевые политики

**Ожидаемый результат:**
- Cilium работает
- BGP связность установлена
- Политики применены

**Критерии успеха:**
- ✅ Cilium активен
- ✅ BGP работает
- ✅ Политики применены

---

### 2.3 Сценарий: Проверка MHE RADIUS

**ID:** INT-MHE-RADIUS-001  
**Приоритет:** Критический  
**Время выполнения:** 25 минут  

**Предусловия:**
- MHE RADIUS развернут
- Тестовые пользователи созданы

**Шаги выполнения:**
1. Создать пользователя с групповой политикой №2
2. Выполнить аутентификацию
3. Проверить формирование индивидуального списка портов
4. Проверить применение политики
5. Создать пользователей с групповыми политиками №1-9
6. Выполнить аутентификацию
7. Проверить применение групповых политик
8. Проверить фильтрацию трафика

**Ожидаемый результат:**
- Индивидуальные политики работают
- Групповые политики применяются
- Фильтрация функционирует

**Критерии успеха:**
- ✅ Индивидуальные политики
- ✅ Групповые политики
- ✅ Фильтрация работает

---

### 2.4 Сценарий: Проверка MHE Log

**ID:** INT-MHE-LOG-001  
**Приоритет:** Высокий  
**Время выполнения:** 20 минут  

**Предусловия:**
- MHE Log развернут
- Система сбора настроена

**Шаги выполнения:**
1. Сгенерировать тестовые события безопасности
2. Проверить сбор логов
3. Проверить отправку в систему сбора
4. Проверить формат сообщений
5. Проверить обработку различных типов событий
6. Проверить производительность сбора
7. Проверить надежность доставки

**Ожидаемый результат:**
- События собираются
- Логи отправляются
- Формат корректный

**Критерии успеха:**
- ✅ Сбор работает
- ✅ Отправка работает
- ✅ Формат корректный

---

### 2.5 Сценарий: Проверка MHE Restore

**ID:** INT-MHE-RESTORE-001  
**Приоритет:** Высокий  
**Время выполнения:** 30 минут  

**Предусловия:**
- MHE Restore развернут
- FortiGate настроен

**Шаги выполнения:**
1. Создать тестовые политики в FortiGate
2. Сохранить конфигурацию
3. Отключить FortiGate
4. Проверить работу MHE Restore
5. Включить FortiGate
6. Проверить восстановление политик
7. Сравнить политики до и после
8. Проверить время восстановления

**Ожидаемый результат:**
- Политики восстанавливаются
- Время восстановления в норме
- Конфигурация корректна

**Критерии успеха:**
- ✅ Восстановление работает
- ✅ Время в норме
- ✅ Конфигурация корректна

---

## 3. СЦЕНАРИИ ОТКАЗОУСТОЙЧИВОСТИ

### 3.1 Сценарий: Отказ активного FortiGate

**ID:** FAIL-FG-001  
**Приоритет:** Критический  
**Время выполнения:** 45 минут  

**Предусловия:**
- Кластер FortiGate настроен
- Тестовый трафик генерируется

**Шаги выполнения:**
1. Определить активное устройство
2. Начать генерацию тестового трафика
3. Отключить активное устройство
4. Зафиксировать время переключения
5. Проверить работу резервного устройства
6. Проверить восстановление сервисов
7. Включить устройство обратно
8. Проверить восстановление кластера
9. Проверить синхронизацию

**Ожидаемый результат:**
- Переключение автоматическое
- Время переключения ≤ 30 сек
- Сервисы восстанавливаются
- Кластер восстанавливается

**Критерии успеха:**
- ✅ Переключение автоматическое
- ✅ Время в норме
- ✅ Сервисы восстанавливаются
- ✅ Кластер восстанавливается

---

### 3.2 Сценарий: Отказ коммутатора

**ID:** FAIL-SW-001  
**Приоритет:** Высокий  
**Время выполнения:** 30 минут  

**Предусловия:**
- Резервный коммутатор настроен
- Тестовый трафик генерируется

**Шаги выполнения:**
1. Определить коммутатор подключенный к FW
2. Начать генерацию тестового трафика
3. Отключить коммутатор
4. Зафиксировать время переключения
5. Проверить переключение на резервный
6. Проверить восстановление соединений
7. Включить коммутатор обратно
8. Проверить восстановление

**Ожидаемый результат:**
- Переключение автоматическое
- Время переключения ≤ 60 сек
- Соединения восстанавливаются
- Система возвращается в норму

**Критерии успеха:**
- ✅ Переключение автоматическое
- ✅ Время в норме
- ✅ Соединения восстанавливаются
- ✅ Система восстанавливается

---

### 3.3 Сценарий: Отказ узла K8s

**ID:** FAIL-K8S-001  
**Приоритет:** Высокий  
**Время выполнения:** 40 минут  

**Предусловия:**
- Кластер K8s настроен
- Поды распределены по узлам

**Шаги выполнения:**
1. Определить узел кластера
2. Проверить распределение подов
3. Отключить узел
4. Зафиксировать время переключения
5. Проверить переключение подов
6. Проверить восстановление сервисов
7. Включить узел обратно
8. Проверить восстановление кластера
9. Проверить балансировку нагрузки

**Ожидаемый результат:**
- Поды переключаются
- Время переключения ≤ 5 мин
- Сервисы восстанавливаются
- Кластер восстанавливается

**Критерии успеха:**
- ✅ Поды переключаются
- ✅ Время в норме
- ✅ Сервисы восстанавливаются
- ✅ Кластер восстанавливается

---

## 4. СЦЕНАРИИ ПРОИЗВОДИТЕЛЬНОСТИ

### 4.1 Сценарий: Нагрузочное тестирование

**ID:** PERF-LOAD-001  
**Приоритет:** Средний  
**Время выполнения:** 60 минут  

**Предусловия:**
- Система стабильна
- Инструменты нагрузочного тестирования готовы

**Шаги выполнения:**
1. Определить базовые метрики
2. Начать генерацию нагрузки
3. Постепенно увеличивать нагрузку
4. Мониторить метрики системы
5. Определить точку отказа
6. Проанализировать результаты
7. Подготовить отчет

**Ожидаемый результат:**
- Система выдерживает нагрузку
- Производительность в норме
- Отказ происходит плавно

**Критерии успеха:**
- ✅ Нагрузка выдерживается
- ✅ Производительность в норме
- ✅ Отказ плавный

---

## 5. СЦЕНАРИИ БЕЗОПАСНОСТИ

### 5.1 Сценарий: Тестирование сервисов безопасности

**ID:** SEC-SERVICES-001  
**Приоритет:** Высокий  
**Время выполнения:** 45 минут  

**Предусловия:**
- Сервисы безопасности настроены
- Тестовые угрозы подготовлены

**Шаги выполнения:**
1. Тестирование антивируса
2. Тестирование IPS
3. Тестирование DNS фильтрации
4. Тестирование SSL-Inspection
5. Проверка логов безопасности
6. Анализ эффективности
7. Подготовка отчета

**Ожидаемый результат:**
- Угрозы блокируются
- Логи корректны
- Эффективность высокая

**Критерии успеха:**
- ✅ Угрозы блокируются
- ✅ Логи корректны
- ✅ Эффективность высокая

---

## 6. МАТРИЦА ПОКРЫТИЯ ТЕСТАМИ

| Компонент | Функциональные | Интеграционные | Нагрузочные | Отказоустойчивость |
|-----------|----------------|----------------|-------------|-------------------|
| FortiGate | ✅ | ✅ | ✅ | ✅ |
| K8s Cluster | ✅ | ✅ | ✅ | ✅ |
| MHE RADIUS | ✅ | ✅ | ✅ | ✅ |
| MHE Log | ✅ | ✅ | ✅ | ✅ |
| MHE Restore | ✅ | ✅ | ❌ | ✅ |
| MHE LDAP | ✅ | ✅ | ❌ | ❌ |
| MHE E-Mail | ✅ | ✅ | ❌ | ❌ |
| StarRocks | ✅ | ✅ | ✅ | ❌ |
| Superset | ✅ | ✅ | ❌ | ❌ |

---

**Документ подготовлен:** [Дата]  
**Версия:** 1.0  
**Статус:** Утвержден